<UserControl x:Class="HospitalityPOS.WPF.Controls.FloorGridControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:HospitalityPOS.WPF.Converters"
             mc:Ignorable="d"
             d:DesignHeight="400" d:DesignWidth="600"
             Background="#252545">

    <UserControl.Resources>
        <converters:TableStatusColorConverter x:Key="TableStatusColor"/>
        <converters:TableShapeRadiusConverter x:Key="TableShapeRadius"/>
        <converters:GridCellSizeConverter x:Key="GridCellSize"/>
    </UserControl.Resources>

    <Grid>
        <!-- Grid Canvas -->
        <Canvas x:Name="GridCanvas"
                ClipToBounds="True"
                AllowDrop="True"
                Background="Transparent">

            <!-- Grid lines will be drawn in code-behind -->

            <!-- Tables ItemsControl -->
            <ItemsControl x:Name="TablesControl"
                          ItemsSource="{Binding Tables, RelativeSource={RelativeSource AncestorType=UserControl}}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemContainerStyle>
                    <Style>
                        <Setter Property="Canvas.Left" Value="{Binding GridX, Converter={StaticResource GridCellSize}}"/>
                        <Setter Property="Canvas.Top" Value="{Binding GridY, Converter={StaticResource GridCellSize}}"/>
                    </Style>
                </ItemsControl.ItemContainerStyle>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border x:Name="TableBorder"
                                Width="{Binding Width, Converter={StaticResource GridCellSize}}"
                                Height="{Binding Height, Converter={StaticResource GridCellSize}}"
                                Background="{Binding Status, Converter={StaticResource TableStatusColor}}"
                                BorderBrush="#333333"
                                BorderThickness="2"
                                CornerRadius="{Binding Shape, Converter={StaticResource TableShapeRadius}}"
                                Cursor="Hand"
                                ToolTip="{Binding TableNumber}"
                                MouseLeftButtonDown="Table_MouseLeftButtonDown"
                                MouseMove="Table_MouseMove"
                                MouseLeftButtonUp="Table_MouseLeftButtonUp">
                            <Border.Effect>
                                <DropShadowEffect ShadowDepth="2" BlurRadius="4" Opacity="0.3"/>
                            </Border.Effect>
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <TextBlock Text="{Binding TableNumber}"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Foreground="White"
                                           HorizontalAlignment="Center"/>
                                <TextBlock FontSize="11"
                                           Foreground="#EEEEEE"
                                           HorizontalAlignment="Center">
                                    <Run Text="("/>
                                    <Run Text="{Binding Capacity, Mode=OneWay}"/>
                                    <Run Text=")"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                        <DataTemplate.Triggers>
                            <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                <Setter TargetName="TableBorder" Property="BorderBrush" Value="#FFFFFF"/>
                                <Setter TargetName="TableBorder" Property="BorderThickness" Value="3"/>
                            </DataTrigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Canvas>

        <!-- Empty State -->
        <TextBlock Text="No tables on this floor. Click 'Add Table' to get started."
                   FontSize="14"
                   Foreground="#8888AA"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Visibility="{Binding HasNoTables, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVisibility}}"/>
    </Grid>
</UserControl>
