<Window x:Class="HospitalityPOS.WPF.Views.CombinedXReportView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:HospitalityPOS.WPF.ViewModels"
        xmlns:converters="clr-namespace:HospitalityPOS.WPF.Converters"
        mc:Ignorable="d"
        Title="Combined X-Report - All Terminals"
        Width="1100"
        Height="850"
        WindowStartupLocation="CenterOwner"
        Background="#0F0F1A">

    <Window.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter" />

        <!-- Styles -->
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#4CAF50" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,16,0,8" />
        </Style>

        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#8888AA" />
            <Setter Property="FontSize" Value="13" />
        </Style>

        <Style x:Key="ValueStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="White" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontFamily" Value="Consolas" />
            <Setter Property="HorizontalAlignment" Value="Right" />
        </Style>

        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="#1A1A2E" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,0,0,12" />
        </Style>

        <Style x:Key="StatCardStyle" TargetType="Border">
            <Setter Property="Background" Value="#252538" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="16,12" />
        </Style>

        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Height" Value="36" />
            <Setter Property="Padding" Value="16,0" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#1A1A2E" Padding="24,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="COMBINED X-REPORT"
                               Foreground="#FFD700"
                               FontSize="22"
                               FontWeight="Bold" />
                    <TextBlock Foreground="#8888AA" FontSize="12" Margin="0,4,0,0">
                        <Run Text="All Terminals - " />
                        <Run Text="{Binding TerminalCount}" />
                        <Run Text=" active" />
                    </TextBlock>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Refresh"
                            Style="{StaticResource ActionButtonStyle}"
                            Background="#3D3D5C"
                            Foreground="White"
                            Command="{Binding RefreshCommand}"
                            Margin="0,0,8,0" />
                    <Button Content="Print"
                            Style="{StaticResource ActionButtonStyle}"
                            Background="#3D3D5C"
                            Foreground="White"
                            Command="{Binding PrintReportCommand}"
                            Margin="0,0,8,0" />
                    <Button Content="Export"
                            Style="{StaticResource ActionButtonStyle}"
                            Background="#4CAF50"
                            Foreground="White"
                            Command="{Binding ExportReportCommand}" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Padding="24,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="16" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Left Column -->
                <StackPanel Grid.Column="0">
                    <!-- Report Info Card -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="{Binding BusinessName}"
                                       Foreground="White"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       HorizontalAlignment="Center" />
                            <TextBlock Text="{Binding ReportNumber}"
                                       Foreground="#FFD700"
                                       FontSize="14"
                                       HorizontalAlignment="Center"
                                       Margin="0,8,0,0" />
                            <Border Background="#4A4A6A" Height="1" Margin="0,12" />
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Shift Started:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding ShiftStarted, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Style="{StaticResource ValueStyle}" />
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Duration:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding ShiftDurationFormatted}" Style="{StaticResource ValueStyle}" />
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Generated By:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding GeneratedByName}" Style="{StaticResource ValueStyle}" />
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Combined Sales Summary -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="COMBINED SALES SUMMARY" Style="{StaticResource SectionHeaderStyle}" Margin="0,0,0,12" />
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="8" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Gross Sales:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding GrossSales, StringFormat='KSh {0:N2}'}" Style="{StaticResource ValueStyle}" />
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Discounts:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Discounts, StringFormat='-KSh {0:N2}'}" Foreground="#FF6B6B" FontFamily="Consolas" FontSize="13" HorizontalAlignment="Right" />
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Refunds:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding Refunds, StringFormat='-KSh {0:N2}'}" Foreground="#FF6B6B" FontFamily="Consolas" FontSize="13" HorizontalAlignment="Right" />
                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Net Sales:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding NetSales, StringFormat='KSh {0:N2}'}" Style="{StaticResource ValueStyle}" />
                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Tax:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding TaxAmount, StringFormat='KSh {0:N2}'}" Style="{StaticResource ValueStyle}" />
                                <TextBlock Grid.Row="5" Grid.Column="0" Text="Tips:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding TipsCollected, StringFormat='KSh {0:N2}'}" Style="{StaticResource ValueStyle}" />
                                <Border Grid.Row="6" Grid.ColumnSpan="2" Background="#4A4A6A" Height="1" />
                                <TextBlock Grid.Row="7" Grid.Column="0" Text="GRAND TOTAL:" Foreground="White" FontSize="15" FontWeight="Bold" />
                                <TextBlock Grid.Row="7" Grid.Column="1" Text="{Binding GrandTotal, StringFormat='KSh {0:N2}'}" Foreground="#4CAF50" FontFamily="Consolas" FontSize="15" FontWeight="Bold" HorizontalAlignment="Right" />
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Statistics -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="STATISTICS" Style="{StaticResource SectionHeaderStyle}" Margin="0,0,0,12" />
                            <UniformGrid Columns="3" Margin="0,0,0,8">
                                <Border Style="{StaticResource StatCardStyle}" Margin="0,0,8,0">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding TransactionCount}" Foreground="White" FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" />
                                        <TextBlock Text="Transactions" Foreground="#8888AA" FontSize="11" HorizontalAlignment="Center" />
                                    </StackPanel>
                                </Border>
                                <Border Style="{StaticResource StatCardStyle}" Margin="0,0,8,0">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding AverageTransaction, StringFormat='{}{0:N0}'}" Foreground="White" FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" />
                                        <TextBlock Text="Avg Transaction" Foreground="#8888AA" FontSize="11" HorizontalAlignment="Center" />
                                    </StackPanel>
                                </Border>
                                <Border Style="{StaticResource StatCardStyle}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding VoidCount}" Foreground="#FF6B6B" FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" />
                                        <TextBlock Text="Voids" Foreground="#8888AA" FontSize="11" HorizontalAlignment="Center" />
                                    </StackPanel>
                                </Border>
                            </UniformGrid>
                        </StackPanel>
                    </Border>

                    <!-- Payment Breakdown (Grouped by Type) -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="PAYMENT BREAKDOWN" Style="{StaticResource SectionHeaderStyle}" Margin="0,0,0,12" />
                            <ItemsControl ItemsSource="{Binding PaymentTypeBreakdown}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Margin="0,4,0,8">
                                            <!-- Payment Type Header -->
                                            <Border Background="#252538" CornerRadius="4" Padding="8,6" Margin="0,0,0,4">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="Auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Foreground="White" FontWeight="SemiBold" FontSize="12">
                                                        <Run Text="{Binding PaymentTypeName}" />
                                                        <Run Text=" (" Foreground="#8888AA" /><Run Text="{Binding TotalTransactionCount}" Foreground="#8888AA" /><Run Text=")" Foreground="#8888AA" />
                                                    </TextBlock>
                                                    <TextBlock Grid.Column="1" Foreground="#4CAF50" FontWeight="Bold" FontFamily="Consolas" FontSize="12" Margin="0,0,8,0">
                                                        <Run Text="KSh " /><Run Text="{Binding TotalAmount, StringFormat='N2'}" />
                                                    </TextBlock>
                                                    <TextBlock Grid.Column="2" Foreground="#8888AA" FontFamily="Consolas" FontSize="10" VerticalAlignment="Center">
                                                        <Run Text="{Binding Percentage, StringFormat='({0:N1}%)'}" />
                                                    </TextBlock>
                                                </Grid>
                                            </Border>
                                            <!-- Payment Methods within Type -->
                                            <ItemsControl ItemsSource="{Binding Methods}" Margin="16,0,0,0">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid Margin="0,2">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>
                                                            <TextBlock Grid.Column="0" Style="{StaticResource LabelStyle}" FontSize="11">
                                                                <Run Text="{Binding PaymentMethodName}" />
                                                                <Run Text=" (" /><Run Text="{Binding TransactionCount}" /><Run Text=")" />
                                                            </TextBlock>
                                                            <TextBlock Grid.Column="1" Text="{Binding Amount, StringFormat='KSh {0:N2}'}" Style="{StaticResource ValueStyle}" FontSize="11" />
                                                        </Grid>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Right Column -->
                <StackPanel Grid.Column="2">
                    <!-- Terminal Breakdown -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="TERMINAL BREAKDOWN" Style="{StaticResource SectionHeaderStyle}" Margin="0,0,0,12" />
                            <ItemsControl ItemsSource="{Binding TerminalBreakdown}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#252538" CornerRadius="6" Margin="0,0,0,8" Padding="12">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>

                                                <!-- Terminal Header -->
                                                <Grid Grid.Row="0">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="Auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <Ellipse Grid.Column="0" Width="8" Height="8" Fill="{Binding StatusColor}" Margin="0,0,8,0" VerticalAlignment="Center" />
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="{Binding TerminalCode}" Foreground="White" FontWeight="SemiBold" FontSize="13" />
                                                        <TextBlock Text="{Binding TerminalName}" Foreground="#8888AA" FontSize="11" />
                                                    </StackPanel>
                                                    <Button Grid.Column="2"
                                                            Content="View"
                                                            Background="#3D3D5C"
                                                            Foreground="White"
                                                            Padding="12,4"
                                                            FontSize="11"
                                                            BorderThickness="0"
                                                            Cursor="Hand"
                                                            Command="{Binding DataContext.ViewTerminalDetailsCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                            CommandParameter="{Binding}">
                                                        <Button.Template>
                                                            <ControlTemplate TargetType="Button">
                                                                <Border Background="{TemplateBinding Background}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Button.Template>
                                                    </Button>
                                                </Grid>

                                                <!-- Terminal Stats -->
                                                <Grid Grid.Row="1" Margin="16,8,0,0">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="Auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                    </Grid.RowDefinitions>
                                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Transactions:" Foreground="#8888AA" FontSize="11" />
                                                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding TransactionCount}" Foreground="White" FontSize="11" HorizontalAlignment="Right" />
                                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Net Sales:" Foreground="#8888AA" FontSize="11" />
                                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding NetSales, StringFormat='KSh {0:N2}'}" Foreground="White" FontFamily="Consolas" FontSize="11" HorizontalAlignment="Right" />
                                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Grand Total:" Foreground="#8888AA" FontSize="11" />
                                                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding GrandTotal, StringFormat='KSh {0:N2}'}" Foreground="#4CAF50" FontFamily="Consolas" FontSize="11" FontWeight="SemiBold" HorizontalAlignment="Right" />
                                                </Grid>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- Cash Drawer Summary -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="COMBINED CASH DRAWER" Style="{StaticResource SectionHeaderStyle}" Margin="0,0,0,12" />
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="8" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Opening Float:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding OpeningFloat, StringFormat='KSh {0:N2}'}" Style="{StaticResource ValueStyle}" />
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="+ Cash Received:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding CashReceived, StringFormat='KSh {0:N2}'}" Foreground="#4CAF50" FontFamily="Consolas" FontSize="13" HorizontalAlignment="Right" />
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="- Cash Refunds:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding CashRefunds, StringFormat='-KSh {0:N2}'}" Foreground="#FF6B6B" FontFamily="Consolas" FontSize="13" HorizontalAlignment="Right" />
                                <TextBlock Grid.Row="3" Grid.Column="0" Text="- Cash Payouts:" Style="{StaticResource LabelStyle}" />
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding CashPayouts, StringFormat='-KSh {0:N2}'}" Foreground="#FF6B6B" FontFamily="Consolas" FontSize="13" HorizontalAlignment="Right" />
                                <Border Grid.Row="4" Grid.ColumnSpan="2" Background="#4A4A6A" Height="1" />
                                <TextBlock Grid.Row="5" Grid.Column="0" Text="EXPECTED CASH:" Foreground="White" FontWeight="Bold" />
                                <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding ExpectedCash, StringFormat='KSh {0:N2}'}" Foreground="#4CAF50" FontFamily="Consolas" FontSize="15" FontWeight="Bold" HorizontalAlignment="Right" />
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Cashier Sessions -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="CASHIER SESSIONS (All Terminals)" Style="{StaticResource SectionHeaderStyle}" Margin="0,0,0,12" />
                            <ItemsControl ItemsSource="{Binding CashierSessions}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#252538" CornerRadius="4" Margin="0,0,0,6" Padding="10">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Foreground="White" FontSize="12">
                                                        <Run Text="{Binding CashierName}" FontWeight="SemiBold" />
                                                        <Run Text=" @ " Foreground="#8888AA" />
                                                        <Run Text="{Binding TerminalCode}" Foreground="#FFD700" />
                                                    </TextBlock>
                                                    <TextBlock Foreground="#8888AA" FontSize="10">
                                                        <Run Text="{Binding TimeRange}" />
                                                        <Run Text=" (" /><Run Text="{Binding DurationFormatted}" /><Run Text=")" />
                                                    </TextBlock>
                                                </StackPanel>
                                                <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                                    <TextBlock Text="{Binding SalesTotal, StringFormat='KSh {0:N2}'}" Foreground="White" FontFamily="Consolas" FontSize="12" HorizontalAlignment="Right" />
                                                    <TextBlock Foreground="#8888AA" FontSize="10" HorizontalAlignment="Right">
                                                        <Run Text="{Binding TransactionCount}" />
                                                        <Run Text=" txns" />
                                                    </TextBlock>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- Footer -->
        <Border Grid.Row="2" Background="#1A1A2E" Padding="24,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" VerticalAlignment="Center">
                    <Run Text="Generated: " Foreground="#8888AA" />
                    <Run Text="{Binding GeneratedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm:ss}'}" Foreground="White" />
                </TextBlock>

                <Button Grid.Column="1"
                        Content="Close"
                        Style="{StaticResource ActionButtonStyle}"
                        Background="#4CAF50"
                        Foreground="White"
                        Width="100"
                        Click="CloseButton_Click" />
            </Grid>
        </Border>

        <!-- Loading Overlay -->
        <Border Grid.RowSpan="3"
                Background="#80000000"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="Loading Report..."
                           Foreground="White"
                           FontSize="16"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Border>

        <!-- Error Message -->
        <Border Grid.RowSpan="3"
                Background="#80000000"
                Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}">
            <Border Background="#1A1A2E"
                    CornerRadius="8"
                    Padding="24"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    MaxWidth="400">
                <StackPanel>
                    <TextBlock Text="{Binding ErrorMessage}"
                               Foreground="#FF6B6B"
                               FontSize="14"
                               TextWrapping="Wrap"
                               HorizontalAlignment="Center" />
                    <Button Content="Retry"
                            Style="{StaticResource ActionButtonStyle}"
                            Background="#4CAF50"
                            Foreground="White"
                            Command="{Binding RefreshCommand}"
                            HorizontalAlignment="Center"
                            Margin="0,16,0,0" />
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</Window>
