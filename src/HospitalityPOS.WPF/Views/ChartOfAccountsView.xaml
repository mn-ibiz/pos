<UserControl x:Class="HospitalityPOS.WPF.Views.ChartOfAccountsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:HospitalityPOS.WPF.ViewModels"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:ChartOfAccountsViewModel}"
             d:DesignHeight="700" d:DesignWidth="1200">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#1976D2" Padding="20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <TextBlock Text="Chart of Accounts" FontSize="28" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="Manage your general ledger accounts" FontSize="14" Foreground="#B3FFFFFF" Margin="0,5,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="Seed Defaults" Command="{Binding SeedDefaultAccountsCommand}"
                            Style="{StaticResource SecondaryButtonStyle}" Margin="0,0,10,0"/>
                    <Button Content="+ New Account" Command="{Binding NewAccountCommand}"
                            Style="{StaticResource PrimaryButtonStyle}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Filter Bar -->
        <Border Grid.Row="1" Background="#F5F5F5" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="250"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <ComboBox Grid.Column="0" ItemsSource="{Binding AccountTypes}"
                          SelectedItem="{Binding SelectedAccountType}"
                          Margin="0,0,10,0" Padding="10">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <TextBox Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Padding="10" Margin="0,0,10,0">
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Style.Triggers>
                                <Trigger Property="Text" Value="">
                                    <Setter Property="Background">
                                        <Setter.Value>
                                            <VisualBrush Stretch="None" AlignmentX="Left">
                                                <VisualBrush.Visual>
                                                    <TextBlock Text="Search accounts..." Foreground="Gray" Margin="5,0,0,0"/>
                                                </VisualBrush.Visual>
                                            </VisualBrush>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <Button Grid.Column="2" Content="Clear" Command="{Binding ClearFilterCommand}"
                        Style="{StaticResource SecondaryButtonStyle}"/>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <!-- Accounts List -->
            <Border Grid.Column="0" Margin="15" Background="White" CornerRadius="8">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.1"/>
                </Border.Effect>

                <DataGrid ItemsSource="{Binding FilteredAccounts}"
                          SelectedItem="{Binding SelectedAccount}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="Column"
                          BorderThickness="0"
                          RowHeight="45">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Code" Binding="{Binding AccountCode}" Width="100"/>
                        <DataGridTextColumn Header="Account Name" Binding="{Binding AccountName}" Width="*"/>
                        <DataGridTextColumn Header="Type" Binding="{Binding AccountType}" Width="100"/>
                        <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="200"/>
                        <DataGridTemplateColumn Header="Status" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Padding="5,2" CornerRadius="3"
                                            Background="{Binding IsActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#4CAF50|#9E9E9E'}">
                                        <TextBlock Text="{Binding IsActive, Converter={StaticResource BoolToTextConverter}, ConverterParameter='Active|Inactive'}"
                                                   Foreground="White" FontSize="11"/>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>

            <!-- Edit Panel -->
            <Border Grid.Column="1" Margin="0,15,15,15" Background="White" CornerRadius="8"
                    Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}}">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.1"/>
                </Border.Effect>

                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Text="Account Details" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,20"/>

                        <TextBlock Text="Account Code" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding EditAccountCode, UpdateSourceTrigger=PropertyChanged}"
                                 Padding="10" Margin="0,0,0,15"/>

                        <TextBlock Text="Account Name" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding EditAccountName, UpdateSourceTrigger=PropertyChanged}"
                                 Padding="10" Margin="0,0,0,15"/>

                        <TextBlock Text="Account Type" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <ComboBox ItemsSource="{Binding AccountTypes}"
                                  SelectedItem="{Binding EditAccountType}"
                                  Padding="10" Margin="0,0,0,15"/>

                        <TextBlock Text="Parent Account (Optional)" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <ComboBox ItemsSource="{Binding ParentAccounts}"
                                  SelectedValue="{Binding EditParentAccountId}"
                                  SelectedValuePath="Id"
                                  DisplayMemberPath="AccountName"
                                  Padding="10" Margin="0,0,0,15"/>

                        <TextBlock Text="Description" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding EditDescription, UpdateSourceTrigger=PropertyChanged}"
                                 Padding="10" Margin="0,0,0,15"
                                 TextWrapping="Wrap" AcceptsReturn="True" Height="80"/>

                        <CheckBox Content="Active" IsChecked="{Binding EditIsActive}" Margin="0,0,0,20"/>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Cancel" Command="{Binding CancelEditCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}" Margin="0,0,10,0"/>
                            <Button Content="Save" Command="{Binding SaveAccountCommand}"
                                    Style="{StaticResource PrimaryButtonStyle}"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- View Panel (when not editing) -->
            <Border Grid.Column="1" Margin="0,15,15,15" Background="White" CornerRadius="8"
                    Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.1"/>
                </Border.Effect>

                <Grid>
                    <StackPanel Margin="20" Visibility="{Binding SelectedAccount, Converter={StaticResource NullToVisibilityConverter}}">
                        <TextBlock Text="Account Details" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,20"/>

                        <TextBlock Text="Account Code" FontSize="12" Foreground="Gray"/>
                        <TextBlock Text="{Binding SelectedAccount.AccountCode}" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>

                        <TextBlock Text="Account Name" FontSize="12" Foreground="Gray"/>
                        <TextBlock Text="{Binding SelectedAccount.AccountName}" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>

                        <TextBlock Text="Account Type" FontSize="12" Foreground="Gray"/>
                        <TextBlock Text="{Binding SelectedAccount.AccountType}" FontSize="16" Margin="0,0,0,15"/>

                        <TextBlock Text="Description" FontSize="12" Foreground="Gray"/>
                        <TextBlock Text="{Binding SelectedAccount.Description}" FontSize="14" TextWrapping="Wrap" Margin="0,0,0,15"/>

                        <TextBlock Text="Status" FontSize="12" Foreground="Gray"/>
                        <TextBlock FontSize="14" Margin="0,0,0,20">
                            <TextBlock.Text>
                                <Binding Path="SelectedAccount.IsActive" Converter="{StaticResource BoolToTextConverter}" ConverterParameter="Active|Inactive"/>
                            </TextBlock.Text>
                        </TextBlock>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Edit" Command="{Binding EditAccountCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}" Margin="0,0,10,0"/>
                            <Button Content="Delete" Command="{Binding DeleteAccountCommand}"
                                    Style="{StaticResource DangerButtonStyle}"/>
                        </StackPanel>
                    </StackPanel>

                    <TextBlock Text="Select an account to view details"
                               HorizontalAlignment="Center" VerticalAlignment="Center"
                               Foreground="Gray" FontSize="14"
                               Visibility="{Binding SelectedAccount, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Loading Overlay -->
        <Border Grid.RowSpan="3" Background="#80000000"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4"/>
                <TextBlock Text="Loading..." Foreground="White" Margin="0,10,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
