<Window x:Class="HospitalityPOS.WPF.Views.Dialogs.SplitPaymentDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Split Payment"
        Width="480" Height="620"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        ResizeMode="NoResize"
        Background="#1E1E2E"
        AllowsTransparency="True">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
    </Window.Resources>

    <Border BorderBrush="#3D3D5C" BorderThickness="1" CornerRadius="8" Background="#1E1E2E">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="50"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" Background="#252538" CornerRadius="8,8,0,0" Padding="16,0">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="&#xE8AB;" FontFamily="Segoe MDL2 Assets" FontSize="18"
                                   Foreground="#22C55E" Margin="0,0,10,0" VerticalAlignment="Center"/>
                        <TextBlock Text="Split Payment" FontSize="18" FontWeight="Bold"
                                   Foreground="White" VerticalAlignment="Center"/>
                    </StackPanel>
                    <Button Content="✕" HorizontalAlignment="Right" VerticalAlignment="Center"
                            Background="Transparent" Foreground="#9CA3AF" BorderThickness="0"
                            Width="32" Height="32" FontSize="14" Cursor="Hand"
                            Command="{Binding CancelCommand}">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#3D3D5C"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </Grid>
            </Border>

            <!-- Order Total -->
            <Border Grid.Row="1" Background="#2D2D44" Margin="16,16,16,0" CornerRadius="8" Padding="16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Order Total" Foreground="#9CA3AF" FontSize="14" VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="1" Text="{Binding OrderTotal, StringFormat='KSh {0:N2}'}"
                               Foreground="White" FontSize="24" FontWeight="Bold" FontFamily="Consolas"/>
                </Grid>
            </Border>

            <!-- Payments List -->
            <Border Grid.Row="2" Background="#2D2D44" Margin="16,16,16,0" CornerRadius="8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="PAYMENTS" Foreground="#9CA3AF" FontSize="11"
                               FontWeight="Bold" Margin="16,12"/>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" MaxHeight="160">
                        <ItemsControl ItemsSource="{Binding Payments}" Margin="8,0,8,8">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#3D3D5C" CornerRadius="6" Margin="0,4" Padding="12">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Payment Method Icon -->
                                            <Border Width="36" Height="36" CornerRadius="6">
                                                <Border.Background>
                                                    <SolidColorBrush Color="{Binding MethodColor}"/>
                                                </Border.Background>
                                                <TextBlock Text="{Binding MethodIcon}"
                                                           FontFamily="Segoe MDL2 Assets"
                                                           FontSize="16" Foreground="White"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </Border>

                                            <!-- Method Name -->
                                            <TextBlock Grid.Column="1" Text="{Binding MethodName}"
                                                       Foreground="White" FontSize="14"
                                                       VerticalAlignment="Center" Margin="12,0"/>

                                            <!-- Amount -->
                                            <TextBlock Grid.Column="2"
                                                       Text="{Binding Amount, StringFormat='KSh {0:N2}'}"
                                                       Foreground="#22C55E" FontSize="16" FontWeight="Bold"
                                                       FontFamily="Consolas" VerticalAlignment="Center"/>

                                            <!-- Remove Button -->
                                            <Button Grid.Column="3" Content="✕"
                                                    Background="#EF4444" Foreground="White"
                                                    Width="28" Height="28" Margin="12,0,0,0"
                                                    BorderThickness="0" Cursor="Hand"
                                                    Command="{Binding DataContext.RemovePaymentCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                    CommandParameter="{Binding}">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <!-- Empty State -->
                    <TextBlock Grid.Row="1" Text="No payments added yet"
                               Foreground="#6B7280" FontSize="13" FontStyle="Italic"
                               HorizontalAlignment="Center" VerticalAlignment="Center"
                               Visibility="{Binding Payments.Count, Converter={StaticResource BoolToVisibility}, ConverterParameter=Inverse}"/>
                </Grid>
            </Border>

            <!-- Add Payment Section -->
            <Border Grid.Row="3" Background="#252538" Margin="16,16,16,0" CornerRadius="8" Padding="16">
                <StackPanel>
                    <TextBlock Text="ADD PAYMENT" Foreground="#9CA3AF" FontSize="11"
                               FontWeight="Bold" Margin="0,0,0,12"/>

                    <!-- Amount Input -->
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="KSh" Foreground="White" FontSize="18" FontWeight="Bold"
                                   VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Grid.Column="1" Text="{Binding PaymentAmount, UpdateSourceTrigger=PropertyChanged}"
                                 Background="#2D2D44" Foreground="White" FontSize="22" FontWeight="Bold"
                                 FontFamily="Consolas" BorderBrush="#3D3D5C" BorderThickness="1"
                                 Padding="12,8" HorizontalContentAlignment="Right" VerticalContentAlignment="Center"/>
                    </Grid>

                    <!-- Quick Amount Buttons -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <Button Content="Remaining" Command="{Binding SetRemainingCommand}"
                                Background="#22C55E" Foreground="White" Padding="16,8"
                                FontSize="12" FontWeight="SemiBold" BorderThickness="0" Cursor="Hand" Margin="0,0,8,0">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                        <Button Content="50%" Command="{Binding SetHalfCommand}"
                                Background="#3D3D5C" Foreground="White" Padding="16,8"
                                FontSize="12" BorderThickness="0" Cursor="Hand" Margin="0,0,8,0">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                        <Button Content="Clear" Command="{Binding ClearAmountCommand}"
                                Background="#3D3D5C" Foreground="White" Padding="16,8"
                                FontSize="12" BorderThickness="0" Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>

                    <!-- Payment Method Buttons -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0" Background="#22C55E" Foreground="White"
                                Height="48" Margin="0,0,4,0" BorderThickness="0" Cursor="Hand"
                                Command="{Binding AddCashPaymentCommand}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="6">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE8C7;" FontFamily="Segoe MDL2 Assets" FontSize="14" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                <TextBlock Text="CASH" FontWeight="SemiBold" FontSize="13" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <Button Grid.Column="1" Background="#16A34A" Foreground="White"
                                Height="48" Margin="4,0" BorderThickness="0" Cursor="Hand"
                                Command="{Binding AddMpesaPaymentCommand}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="6">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                            <TextBlock Text="M-PESA" FontWeight="SemiBold" FontSize="13"/>
                        </Button>

                        <Button Grid.Column="2" Background="#3B82F6" Foreground="White"
                                Height="48" Margin="4,0,0,0" BorderThickness="0" Cursor="Hand"
                                Command="{Binding AddCardPaymentCommand}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="6">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE8C7;" FontFamily="Segoe MDL2 Assets" FontSize="14" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                <TextBlock Text="CARD" FontWeight="SemiBold" FontSize="13" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Footer with Balance -->
            <Border Grid.Row="4" Background="#1A1A2E" CornerRadius="0,0,8,8" Padding="16" Margin="0,16,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Remaining Balance -->
                    <StackPanel>
                        <TextBlock Text="REMAINING BALANCE" Foreground="#9CA3AF" FontSize="11" FontWeight="Bold"/>
                        <TextBlock Text="{Binding RemainingBalance, StringFormat='KSh {0:N2}'}"
                                   FontSize="20" FontWeight="Bold" FontFamily="Consolas">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="#EF4444"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsFullyPaid}" Value="True">
                                            <Setter Property="Foreground" Value="#22C55E"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>

                    <!-- Complete Button -->
                    <Button Grid.Column="1" Content="COMPLETE SALE" Width="150" Height="48"
                            Foreground="White" FontSize="13" FontWeight="Bold"
                            BorderThickness="0" Cursor="Hand"
                            IsEnabled="{Binding IsFullyPaid}"
                            Command="{Binding CompleteCommand}">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="#22C55E"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="6"
                                                    Opacity="{TemplateBinding Opacity}">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Opacity" Value="0.5"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
