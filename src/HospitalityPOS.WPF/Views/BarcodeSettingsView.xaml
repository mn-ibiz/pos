<UserControl x:Class="HospitalityPOS.WPF.Views.BarcodeSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1100"
             Loaded="UserControl_Loaded">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#1B5E20"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
        </Style>
    </UserControl.Resources>

    <Grid Background="#F5F5F5">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#FFFFFF" Padding="16" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <TextBlock Text="Barcode &amp; Scale Settings" FontSize="24" FontWeight="Bold" Foreground="#1B5E20"/>
                    <TextBlock Text="Configure weighted barcodes, scales, and barcode sequences" Foreground="#666" Margin="0,4,0,0"/>
                </StackPanel>

                <Button Grid.Column="1" Content="Refresh" Command="{Binding LoadDataCommand}" Padding="16,8"/>
            </Grid>
        </Border>

        <!-- Messages -->
        <StackPanel Grid.Row="0" VerticalAlignment="Bottom" Margin="16,0">
            <TextBlock Text="{Binding ErrorMessage}" Foreground="#D32F2F" TextWrapping="Wrap"
                      Visibility="{Binding ErrorMessage, Converter={StaticResource BoolToVisibility}}"/>
            <TextBlock Text="{Binding SuccessMessage}" Foreground="#1B5E20" TextWrapping="Wrap"
                      Visibility="{Binding SuccessMessage, Converter={StaticResource BoolToVisibility}}"/>
        </StackPanel>

        <!-- Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <Grid Margin="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Weighted Barcode Configurations -->
                <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,8,16">
                    <StackPanel>
                        <Grid>
                            <TextBlock Text="Weighted Barcode Configurations" Style="{StaticResource SectionHeaderStyle}"/>
                            <Button Content="+ New" Command="{Binding NewWeightedConfigCommand}"
                                   HorizontalAlignment="Right" Padding="8,4"/>
                        </Grid>

                        <DataGrid ItemsSource="{Binding WeightedConfigs}" SelectedItem="{Binding SelectedWeightedConfig}"
                                 AutoGenerateColumns="False" IsReadOnly="True" Height="150"
                                 HeadersVisibility="Column" GridLinesVisibility="Horizontal" BorderThickness="0">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="100"/>
                                <DataGridTextColumn Header="Prefix" Binding="{Binding Prefix}" Width="70"/>
                                <DataGridTextColumn Header="Type" Binding="{Binding IsPrice, Converter={StaticResource BoolToVisibility}, ConverterParameter='Price|Weight'}" Width="60"/>
                                <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="50"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Edit" Command="{Binding EditWeightedConfigCommand}" Padding="8,4" Margin="0,0,8,0"/>
                        </StackPanel>

                        <!-- Weighted Config Edit Form -->
                        <Border Visibility="{Binding IsEditingWeightedConfig, Converter={StaticResource BoolToVisibility}}"
                               Background="#F9F9F9" CornerRadius="4" Padding="12" Margin="0,16,0,0">
                            <StackPanel>
                                <TextBlock Text="Edit Configuration" FontWeight="SemiBold" Margin="0,0,0,12"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,8">
                                        <TextBlock Text="Name" FontSize="11" Foreground="#666"/>
                                        <TextBox Text="{Binding EditWeightedName}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,0,0,8">
                                        <TextBlock Text="Prefix" FontSize="11" Foreground="#666"/>
                                        <ComboBox ItemsSource="{Binding PrefixOptions}" SelectedItem="{Binding EditWeightedPrefix}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,8,8">
                                        <TextBlock Text="Article Start" FontSize="11" Foreground="#666"/>
                                        <TextBox Text="{Binding EditArticleCodeStart}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="1" Grid.Column="1" Margin="8,0,0,8">
                                        <TextBlock Text="Article Length" FontSize="11" Foreground="#666"/>
                                        <TextBox Text="{Binding EditArticleCodeLength}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,8,8">
                                        <TextBlock Text="Value Start" FontSize="11" Foreground="#666"/>
                                        <TextBox Text="{Binding EditValueStart}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="2" Grid.Column="1" Margin="8,0,0,8">
                                        <TextBlock Text="Value Length" FontSize="11" Foreground="#666"/>
                                        <TextBox Text="{Binding EditValueLength}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="3" Grid.Column="0" Margin="0,0,8,8">
                                        <TextBlock Text="Decimals" FontSize="11" Foreground="#666"/>
                                        <TextBox Text="{Binding EditValueDecimals}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="3" Grid.Column="1" Margin="8,0,0,8" Orientation="Horizontal">
                                        <CheckBox Content="Is Price" IsChecked="{Binding EditIsPrice}" Margin="0,16,16,0"/>
                                        <CheckBox Content="Active" IsChecked="{Binding EditWeightedIsActive}" Margin="0,16,0,0"/>
                                    </StackPanel>
                                </Grid>

                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                                    <Button Content="Cancel" Command="{Binding CancelWeightedEditCommand}" Padding="8,4" Margin="0,0,8,0"/>
                                    <Button Content="Save" Command="{Binding SaveWeightedConfigCommand}" Padding="8,4"
                                           Background="#1B5E20" Foreground="White" BorderThickness="0"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- Scale Configurations -->
                <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource CardStyle}" Margin="8,0,0,16">
                    <StackPanel>
                        <Grid>
                            <TextBlock Text="Scale Configurations" Style="{StaticResource SectionHeaderStyle}"/>
                            <Button Content="+ New" Command="{Binding NewScaleConfigCommand}"
                                   HorizontalAlignment="Right" Padding="8,4"/>
                        </Grid>

                        <DataGrid ItemsSource="{Binding ScaleConfigs}" SelectedItem="{Binding SelectedScaleConfig}"
                                 AutoGenerateColumns="False" IsReadOnly="True" Height="150"
                                 HeadersVisibility="Column" GridLinesVisibility="Horizontal" BorderThickness="0">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="100"/>
                                <DataGridTextColumn Header="Type" Binding="{Binding ScaleType}" Width="80"/>
                                <DataGridTextColumn Header="Protocol" Binding="{Binding Protocol}" Width="60"/>
                                <DataGridTextColumn Header="Status" Binding="{Binding LastStatus}" Width="70"/>
                                <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="50"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Edit" Command="{Binding EditScaleConfigCommand}" Padding="8,4" Margin="0,0,8,0"/>
                            <Button Content="Activate" Command="{Binding ActivateScaleCommand}" Padding="8,4"/>
                        </StackPanel>

                        <!-- Scale Config Edit Form -->
                        <Border Visibility="{Binding IsEditingScaleConfig, Converter={StaticResource BoolToVisibility}}"
                               Background="#F9F9F9" CornerRadius="4" Padding="12" Margin="0,16,0,0">
                            <StackPanel>
                                <TextBlock Text="Edit Scale" FontWeight="SemiBold" Margin="0,0,0,12"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,8">
                                        <TextBlock Text="Name" FontSize="11" Foreground="#666"/>
                                        <TextBox Text="{Binding EditScaleName}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,0,0,8">
                                        <TextBlock Text="Type" FontSize="11" Foreground="#666"/>
                                        <ComboBox ItemsSource="{Binding ScaleTypeOptions}" SelectedItem="{Binding EditScaleType}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,8,8">
                                        <TextBlock Text="Protocol" FontSize="11" Foreground="#666"/>
                                        <ComboBox ItemsSource="{Binding ProtocolOptions}" SelectedItem="{Binding EditScaleProtocol}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="1" Grid.Column="1" Margin="8,0,0,8">
                                        <TextBlock Text="Connection (COM/IP)" FontSize="11" Foreground="#666"/>
                                        <TextBox Text="{Binding EditConnectionString}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,8,8">
                                        <TextBlock Text="Baud Rate" FontSize="11" Foreground="#666"/>
                                        <TextBox Text="{Binding EditBaudRate}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="2" Grid.Column="1" Margin="8,0,0,8">
                                        <TextBlock Text="Weight Unit" FontSize="11" Foreground="#666"/>
                                        <ComboBox ItemsSource="{Binding WeightUnitOptions}" SelectedItem="{Binding EditWeightUnit}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="3" Grid.Column="0" Margin="0,0,8,8">
                                        <TextBlock Text="Min Weight" FontSize="11" Foreground="#666"/>
                                        <TextBox Text="{Binding EditMinWeight}" Padding="6,4"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="3" Grid.Column="1" Margin="8,0,0,8">
                                        <TextBlock Text="Max Weight" FontSize="11" Foreground="#666"/>
                                        <TextBox Text="{Binding EditMaxWeight}" Padding="6,4"/>
                                    </StackPanel>
                                </Grid>

                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <Button Content="Test Connection" Command="{Binding TestScaleConnectionCommand}" Padding="8,4" Margin="0,0,8,0"
                                           IsEnabled="{Binding IsTestingScale, Converter={StaticResource BoolToVisibility}, ConverterParameter=Invert}"/>
                                    <TextBlock Text="{Binding ScaleTestResult}" VerticalAlignment="Center" Foreground="#666"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                                    <Button Content="Cancel" Command="{Binding CancelScaleEditCommand}" Padding="8,4" Margin="0,0,8,0"/>
                                    <Button Content="Save" Command="{Binding SaveScaleConfigCommand}" Padding="8,4"
                                           Background="#1B5E20" Foreground="White" BorderThickness="0"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- Internal Barcode Sequence -->
                <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,8,16">
                    <StackPanel>
                        <TextBlock Text="Internal Barcode Sequence" Style="{StaticResource SectionHeaderStyle}"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                <TextBlock Text="Prefix" FontSize="11" Foreground="#666"/>
                                <TextBox Text="{Binding BarcodeSequence.Prefix}" Padding="8,6"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="8,0">
                                <TextBlock Text="Last Sequence #" FontSize="11" Foreground="#666"/>
                                <TextBox Text="{Binding BarcodeSequence.LastSequenceNumber}" Padding="8,6"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Margin="8,0,0,0">
                                <TextBlock Text="Sequence Digits" FontSize="11" Foreground="#666"/>
                                <TextBox Text="{Binding BarcodeSequence.SequenceDigits}" Padding="8,6"/>
                            </StackPanel>
                        </Grid>

                        <Button Content="Update Sequence" Command="{Binding UpdateBarcodeSequenceCommand}"
                               Padding="12,6" HorizontalAlignment="Left" Margin="0,12,0,0"/>

                        <TextBlock Text="Internal barcodes are generated with format: Prefix + Sequence + Check Digit"
                                  Foreground="#666" FontSize="11" Margin="0,12,0,0" TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Barcode Testing -->
                <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource CardStyle}" Margin="8,0,0,16">
                    <StackPanel>
                        <TextBlock Text="Barcode Testing" Style="{StaticResource SectionHeaderStyle}"/>

                        <TextBlock Text="Enter barcode to test lookup" FontSize="11" Foreground="#666" Margin="0,0,0,4"/>
                        <TextBox Text="{Binding TestBarcodeInput, UpdateSourceTrigger=PropertyChanged}"
                                Padding="10,8" Margin="0,0,0,12"/>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <Button Content="Test Lookup" Command="{Binding TestBarcodeLookupCommand}"
                                   Padding="12,6" Margin="0,0,8,0"/>
                            <Button Content="Parse Weighted" Command="{Binding TestWeightedBarcodeCommand}"
                                   Padding="12,6"/>
                        </StackPanel>

                        <Border Background="#F5F5F5" CornerRadius="4" Padding="12"
                               Visibility="{Binding TestBarcodeResult, Converter={StaticResource BoolToVisibility}}">
                            <TextBlock Text="{Binding TestBarcodeResult}" TextWrapping="Wrap" FontFamily="Consolas"/>
                        </Border>

                        <TextBlock Margin="0,16,0,0" Foreground="#666" FontSize="11" TextWrapping="Wrap">
                            <Run FontWeight="SemiBold">Weighted Barcode Format:</Run>
                            <LineBreak/>
                            Prefixes 20-22: Price embedded (e.g., 2012345001999)
                            <LineBreak/>
                            Prefixes 23-29: Weight embedded (e.g., 2312345001500)
                        </TextBlock>
                    </StackPanel>
                </Border>
            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>
