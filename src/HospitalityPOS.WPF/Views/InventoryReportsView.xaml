<UserControl x:Class="HospitalityPOS.WPF.Views.InventoryReportsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:HospitalityPOS.WPF.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="1000"
             d:DataContext="{d:DesignInstance vm:InventoryReportsViewModel}">

    <Grid Background="{StaticResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        Content="Back"
                        Command="{Binding GoBackCommand}"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Width="80"/>

                <TextBlock Grid.Column="1"
                           Text="{Binding Title}"
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="White"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- Report Selection and Filters -->
        <Border Grid.Row="1" Background="White" Padding="20" BorderThickness="0,0,0,1" BorderBrush="#E0E0E0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Report Type -->
                <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,20,0">
                    <TextBlock Text="Report Type" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <ComboBox ItemsSource="{Binding ReportTypes}"
                              SelectedItem="{Binding SelectedReportType}"
                              DisplayMemberPath="Name"
                              Width="160"
                              Height="35"/>
                </StackPanel>

                <!-- Category Filter -->
                <StackPanel Grid.Column="1" Grid.Row="0" Margin="0,0,20,0">
                    <TextBlock Text="Category" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <ComboBox Grid.Column="0"
                                  ItemsSource="{Binding Categories}"
                                  SelectedItem="{Binding SelectedCategory}"
                                  DisplayMemberPath="Name"
                                  Width="140"
                                  Height="35"/>
                        <Button Grid.Column="1"
                                Content="X"
                                Command="{Binding ClearCategoryFilterCommand}"
                                Width="30"
                                Height="35"
                                Margin="5,0,0,0"
                                ToolTip="Clear category filter"/>
                    </Grid>
                </StackPanel>

                <!-- Date Range (for Stock Movement) -->
                <StackPanel Grid.Column="2" Grid.Row="0" Margin="0,0,15,0"
                            Visibility="{Binding ShowDateRange, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="From Date" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <DatePicker SelectedDate="{Binding FromDate}"
                                Width="130"
                                Height="35"/>
                </StackPanel>

                <StackPanel Grid.Column="3" Grid.Row="0" Margin="0,0,20,0"
                            Visibility="{Binding ShowDateRange, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="To Date" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <DatePicker SelectedDate="{Binding ToDate}"
                                Width="130"
                                Height="35"/>
                </StackPanel>

                <!-- Dead Stock Days Threshold -->
                <StackPanel Grid.Column="4" Grid.Row="0" Margin="0,0,20,0"
                            Visibility="{Binding ShowDeadStockFilter, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="No Movement Days" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding DeadStockDays, UpdateSourceTrigger=PropertyChanged}"
                             Width="80"
                             Height="35"
                             TextAlignment="Center"
                             VerticalContentAlignment="Center"/>
                </StackPanel>

                <!-- Include Out of Stock Checkbox -->
                <StackPanel Grid.Column="4" Grid.Row="0" Margin="0,0,20,0" VerticalAlignment="Bottom"
                            Visibility="{Binding ShowCurrentStockReport, Converter={StaticResource BoolToVisibilityConverter}, FallbackValue=Collapsed}">
                    <CheckBox Content="Include Out of Stock"
                              IsChecked="{Binding IncludeOutOfStock}"
                              VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Generate Button -->
                <Button Grid.Column="6" Grid.Row="0"
                        Content="Generate Report"
                        Command="{Binding GenerateReportCommand}"
                        Style="{StaticResource PrimaryButtonStyle}"
                        Width="140"
                        Height="40"
                        VerticalAlignment="Bottom"/>

                <!-- Quick Date Buttons (for Stock Movement) -->
                <StackPanel Grid.Column="0" Grid.ColumnSpan="6" Grid.Row="2" Orientation="Horizontal"
                            Visibility="{Binding ShowDateRange, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Button Content="Today"
                            Command="{Binding SetTodayCommand}"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Width="70" Height="30" Margin="0,0,10,0"/>
                    <Button Content="This Week"
                            Command="{Binding SetThisWeekCommand}"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Width="80" Height="30" Margin="0,0,10,0"/>
                    <Button Content="This Month"
                            Command="{Binding SetThisMonthCommand}"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Width="90" Height="30" Margin="0,0,10,0"/>
                    <Button Content="Last 30 Days"
                            Command="{Binding SetLast30DaysCommand}"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Width="100" Height="30"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Report Content -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <Grid Margin="20">
                <!-- No Report Message -->
                <TextBlock Text="Select a report type and click 'Generate Report'"
                           FontSize="16"
                           Foreground="#888"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="{Binding HasReport, Converter={StaticResource BoolToInverseVisibilityConverter}}"/>

                <!-- Current Stock Report Section -->
                <StackPanel Visibility="{Binding ShowCurrentStockReport, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Border Background="{StaticResource PrimaryBrush}" Padding="15" CornerRadius="4,4,0,0">
                        <TextBlock Text="CURRENT STOCK REPORT" FontSize="18" FontWeight="Bold" Foreground="White"/>
                    </Border>

                    <Border Background="White" Padding="15" BorderBrush="#E0E0E0" BorderThickness="1,0,1,1">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Total SKUs" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding CurrentStockReport.TotalSkuCount}" FontSize="24" FontWeight="Bold"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="In Stock" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding CurrentStockReport.ItemsInStock}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource SuccessBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Low Stock" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding CurrentStockReport.LowStockCount}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource WarningBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="3">
                                <TextBlock Text="Out of Stock" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding CurrentStockReport.OutOfStockCount}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource ErrorBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="4">
                                <TextBlock Text="Total Value (Cost)" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding CurrentStockReport.TotalStockValue, StringFormat='KSh {0:N0}'}" FontSize="24" FontWeight="Bold"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <DataGrid ItemsSource="{Binding CurrentStockItems}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              MaxHeight="400"
                              Background="White"
                              Margin="0,10,0,0"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="#E0E0E0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Code" Binding="{Binding ProductCode}" Width="80"/>
                            <DataGridTextColumn Header="Product Name" Binding="{Binding ProductName}" Width="200"/>
                            <DataGridTextColumn Header="Category" Binding="{Binding CategoryName}" Width="120"/>
                            <DataGridTextColumn Header="Stock" Binding="{Binding CurrentStock, StringFormat='{0:N1}'}" Width="80"/>
                            <DataGridTextColumn Header="Unit" Binding="{Binding StockUnit}" Width="60"/>
                            <DataGridTextColumn Header="Min" Binding="{Binding MinStock, StringFormat='{0:N0}'}" Width="60"/>
                            <DataGridTextColumn Header="Cost Price" Binding="{Binding CostPrice, StringFormat='KSh {0:N2}'}" Width="100"/>
                            <DataGridTextColumn Header="Stock Value" Binding="{Binding StockValue, StringFormat='KSh {0:N0}'}" Width="110"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="70"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>

                <!-- Low Stock Report Section -->
                <StackPanel Visibility="{Binding ShowLowStockReport, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Border Background="{StaticResource WarningBrush}" Padding="15" CornerRadius="4,4,0,0">
                        <TextBlock Text="LOW STOCK ALERT" FontSize="18" FontWeight="Bold" Foreground="White"/>
                    </Border>

                    <Border Background="White" Padding="15" BorderBrush="#E0E0E0" BorderThickness="1,0,1,1">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Critical (Out of Stock)" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding LowStockReport.CriticalCount}" FontSize="28" FontWeight="Bold" Foreground="{StaticResource ErrorBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Low Stock Items" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding LowStockReport.LowStockCount}" FontSize="28" FontWeight="Bold" Foreground="{StaticResource WarningBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Total Reorder Value" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding LowStockReport.TotalReorderValue, StringFormat='KSh {0:N0}'}" FontSize="28" FontWeight="Bold"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <DataGrid ItemsSource="{Binding LowStockItems}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              MaxHeight="400"
                              Background="White"
                              Margin="0,10,0,0"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="#E0E0E0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Code" Binding="{Binding ProductCode}" Width="80"/>
                            <DataGridTextColumn Header="Product Name" Binding="{Binding ProductName}" Width="200"/>
                            <DataGridTextColumn Header="Category" Binding="{Binding CategoryName}" Width="120"/>
                            <DataGridTextColumn Header="Current" Binding="{Binding CurrentStock, StringFormat='{0:N1}'}" Width="80"/>
                            <DataGridTextColumn Header="Min" Binding="{Binding MinStock, StringFormat='{0:N0}'}" Width="60"/>
                            <DataGridTextColumn Header="Reorder Qty" Binding="{Binding ReorderQty, StringFormat='{0:N0}'}" Width="90"/>
                            <DataGridTextColumn Header="Cost Price" Binding="{Binding CostPrice, StringFormat='KSh {0:N2}'}" Width="100"/>
                            <DataGridTextColumn Header="Reorder Value" Binding="{Binding ReorderValue, StringFormat='KSh {0:N0}'}" Width="110"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>

                <!-- Stock Movement Report Section -->
                <StackPanel Visibility="{Binding ShowStockMovementReport, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Border Background="{StaticResource InfoBrush}" Padding="15" CornerRadius="4,4,0,0">
                        <TextBlock Text="STOCK MOVEMENT REPORT" FontSize="18" FontWeight="Bold" Foreground="White"/>
                    </Border>

                    <Border Background="White" Padding="15" BorderBrush="#E0E0E0" BorderThickness="1,0,1,1">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Total Received" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding StockMovementReport.TotalReceived, StringFormat='{0:N0}'}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource SuccessBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Total Sold/Out" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding StockMovementReport.TotalSold, StringFormat='{0:N0}'}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource ErrorBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Adjustments" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding StockMovementReport.TotalAdjusted, StringFormat='{0:N0}'}" FontSize="24" FontWeight="Bold"/>
                            </StackPanel>

                            <StackPanel Grid.Column="3">
                                <TextBlock Text="Net Movement" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding StockMovementReport.NetMovement, StringFormat='{0:N0}'}" FontSize="24" FontWeight="Bold"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <DataGrid ItemsSource="{Binding StockMovementItems}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              MaxHeight="400"
                              Background="White"
                              Margin="0,10,0,0"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="#E0E0E0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Date" Binding="{Binding Date, StringFormat='{0:dd/MM/yy}'}" Width="80"/>
                            <DataGridTextColumn Header="Time" Binding="{Binding TimeDisplay}" Width="60"/>
                            <DataGridTextColumn Header="Product" Binding="{Binding ProductName}" Width="180"/>
                            <DataGridTextColumn Header="Type" Binding="{Binding MovementType}" Width="100"/>
                            <DataGridTextColumn Header="Qty" Binding="{Binding Quantity, StringFormat='{0:N1}'}" Width="70"/>
                            <DataGridTextColumn Header="Before" Binding="{Binding PreviousStock, StringFormat='{0:N1}'}" Width="70"/>
                            <DataGridTextColumn Header="After" Binding="{Binding NewStock, StringFormat='{0:N1}'}" Width="70"/>
                            <DataGridTextColumn Header="Reference" Binding="{Binding Reference}" Width="100"/>
                            <DataGridTextColumn Header="User" Binding="{Binding UserName}" Width="100"/>
                            <DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>

                <!-- Stock Valuation Report Section -->
                <StackPanel Visibility="{Binding ShowStockValuationReport, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Border Background="{StaticResource SuccessBrush}" Padding="15" CornerRadius="4,4,0,0">
                        <TextBlock Text="STOCK VALUATION REPORT" FontSize="18" FontWeight="Bold" Foreground="White"/>
                    </Border>

                    <Border Background="White" Padding="15" BorderBrush="#E0E0E0" BorderThickness="1,0,1,1">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Total Cost Value" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding StockValuationReport.TotalCostValue, StringFormat='KSh {0:N0}'}" FontSize="24" FontWeight="Bold"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Total Retail Value" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding StockValuationReport.TotalRetailValue, StringFormat='KSh {0:N0}'}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource SuccessBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Potential Profit" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding StockValuationReport.PotentialProfit, StringFormat='KSh {0:N0}'}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource SuccessBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="3">
                                <TextBlock Text="Margin %" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding StockValuationReport.MarginPercentage, StringFormat='{0:N1}%'}" FontSize="24" FontWeight="Bold"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <TextBlock Text="Valuation by Category" FontSize="16" FontWeight="SemiBold" Margin="0,20,0,10"/>
                    <DataGrid ItemsSource="{Binding CategoryValuations}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              MaxHeight="350"
                              Background="White"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="#E0E0E0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Category" Binding="{Binding CategoryName}" Width="180"/>
                            <DataGridTextColumn Header="Items" Binding="{Binding ItemCount}" Width="70"/>
                            <DataGridTextColumn Header="Units" Binding="{Binding TotalUnits, StringFormat='{0:N0}'}" Width="80"/>
                            <DataGridTextColumn Header="Cost Value" Binding="{Binding CostValue, StringFormat='KSh {0:N0}'}" Width="130"/>
                            <DataGridTextColumn Header="Retail Value" Binding="{Binding RetailValue, StringFormat='KSh {0:N0}'}" Width="130"/>
                            <DataGridTextColumn Header="Potential Profit" Binding="{Binding PotentialProfit, StringFormat='KSh {0:N0}'}" Width="130"/>
                            <DataGridTextColumn Header="Margin %" Binding="{Binding MarginPercentage, StringFormat='{0:N1}%'}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>

                <!-- Dead Stock Report Section -->
                <StackPanel Visibility="{Binding ShowDeadStockReport, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Border Background="{StaticResource ErrorBrush}" Padding="15" CornerRadius="4,4,0,0">
                        <TextBlock Text="DEAD STOCK REPORT" FontSize="18" FontWeight="Bold" Foreground="White"/>
                    </Border>

                    <Border Background="White" Padding="15" BorderBrush="#E0E0E0" BorderThickness="1,0,1,1">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Dead Stock Items" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding DeadStockReport.TotalCount}" FontSize="28" FontWeight="Bold" Foreground="{StaticResource ErrorBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Total Value at Risk" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding DeadStockReport.TotalValue, StringFormat='KSh {0:N0}'}" FontSize="28" FontWeight="Bold" Foreground="{StaticResource ErrorBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Days Threshold" FontSize="12" Foreground="#666"/>
                                <TextBlock Text="{Binding DeadStockReport.DaysThreshold, StringFormat='{0} days'}" FontSize="28" FontWeight="Bold"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <DataGrid ItemsSource="{Binding DeadStockItems}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              MaxHeight="400"
                              Background="White"
                              Margin="0,10,0,0"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="#E0E0E0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Code" Binding="{Binding ProductCode}" Width="80"/>
                            <DataGridTextColumn Header="Product Name" Binding="{Binding ProductName}" Width="200"/>
                            <DataGridTextColumn Header="Category" Binding="{Binding CategoryName}" Width="120"/>
                            <DataGridTextColumn Header="Stock" Binding="{Binding CurrentStock, StringFormat='{0:N1}'}" Width="80"/>
                            <DataGridTextColumn Header="Stock Value" Binding="{Binding StockValue, StringFormat='KSh {0:N0}'}" Width="120"/>
                            <DataGridTextColumn Header="Last Movement" Binding="{Binding LastMovementDate, StringFormat='{0:dd/MM/yyyy}'}" Width="110"/>
                            <DataGridTextColumn Header="Days Idle" Binding="{Binding DaysSinceMovement}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- Footer with Actions -->
        <Border Grid.Row="3" Background="White" Padding="20" BorderThickness="0,1,0,0" BorderBrush="#E0E0E0"
                Visibility="{Binding HasReport, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Generated: " Foreground="#666"/>
                    <TextBlock Text="{Binding CurrentStockReport.GeneratedAt, StringFormat='{0:yyyy-MM-dd HH:mm}'}"
                               Foreground="#666"
                               Visibility="{Binding ShowCurrentStockReport, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    <TextBlock Text="{Binding LowStockReport.GeneratedAt, StringFormat='{0:yyyy-MM-dd HH:mm}'}"
                               Foreground="#666"
                               Visibility="{Binding ShowLowStockReport, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    <TextBlock Text="{Binding StockMovementReport.GeneratedAt, StringFormat='{0:yyyy-MM-dd HH:mm}'}"
                               Foreground="#666"
                               Visibility="{Binding ShowStockMovementReport, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    <TextBlock Text="{Binding StockValuationReport.GeneratedAt, StringFormat='{0:yyyy-MM-dd HH:mm}'}"
                               Foreground="#666"
                               Visibility="{Binding ShowStockValuationReport, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    <TextBlock Text="{Binding DeadStockReport.GeneratedAt, StringFormat='{0:yyyy-MM-dd HH:mm}'}"
                               Foreground="#666"
                               Visibility="{Binding ShowDeadStockReport, Converter={StaticResource BoolToVisibilityConverter}}"/>
                </StackPanel>

                <Button Grid.Column="1"
                        Content="Print Report"
                        Command="{Binding PrintReportCommand}"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Width="120"
                        Height="40"
                        Margin="0,0,10,0"/>

                <Button Grid.Column="2"
                        Content="Export CSV"
                        Command="{Binding ExportCsvCommand}"
                        Style="{StaticResource PrimaryButtonStyle}"
                        Width="120"
                        Height="40"/>
            </Grid>
        </Border>

        <!-- Loading Overlay -->
        <Border Grid.RowSpan="4"
                Background="#80000000"
                Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="{Binding BusyMessage}" FontSize="18" Foreground="White"/>
            </StackPanel>
        </Border>

        <!-- Error Message -->
        <Border Grid.Row="2"
                Background="{StaticResource ErrorBrush}"
                Padding="10"
                Margin="20"
                CornerRadius="4"
                VerticalAlignment="Top"
                Visibility="{Binding HasError, Converter={StaticResource BoolToVisibilityConverter}}">
            <TextBlock Text="{Binding ErrorMessage}" Foreground="White" TextWrapping="Wrap"/>
        </Border>
    </Grid>
</UserControl>
