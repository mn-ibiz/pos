<UserControl x:Class="HospitalityPOS.WPF.Views.TerminalEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:HospitalityPOS.WPF.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="900"
             Background="#1E1E2E">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter" />

        <!-- Form Field Style -->
        <Style x:Key="FormFieldBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="#2D2D44" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,0,0,16" />
        </Style>

        <!-- Label Style -->
        <Style x:Key="FormLabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#AAAACC" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,0,8" />
        </Style>

        <!-- TextBox Style -->
        <Style x:Key="FormTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#3D3D5C" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="12,10" />
            <Setter Property="FontSize" Value="16" />
        </Style>

        <!-- Error Text Style -->
        <Style x:Key="ErrorTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FF6B6B" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Margin" Value="0,4,0,0" />
        </Style>

        <!-- ComboBox Style -->
        <Style x:Key="FormComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="#3D3D5C" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="12,10" />
            <Setter Property="FontSize" Value="16" />
            <Setter Property="Height" Value="44" />
        </Style>
    </UserControl.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Content="Cancel"
                    Command="{Binding CancelCommand}"
                    Background="#3D3D5C"
                    Foreground="White"
                    BorderThickness="0"
                    Padding="16,12"
                    FontSize="14"
                    Cursor="Hand" />

            <TextBlock Grid.Column="1"
                       Text="{Binding PageTitle}"
                       FontSize="28"
                       FontWeight="SemiBold"
                       Foreground="White"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center" />
        </Grid>

        <!-- Form Content -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <Grid>
                <!-- Loading Overlay -->
                <Border Background="#80000000"
                        CornerRadius="12"
                        Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisConverter}}"
                        Panel.ZIndex="10">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <ProgressBar IsIndeterminate="True"
                                     Width="150"
                                     Height="4"
                                     Foreground="#4CAF50" />
                        <TextBlock Text="Saving..."
                                   Foreground="White"
                                   FontSize="14"
                                   Margin="0,12,0,0"
                                   HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>

                <StackPanel MaxWidth="700" HorizontalAlignment="Center">
                    <!-- Basic Information Section -->
                    <TextBlock Text="Basic Information"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="White"
                               Margin="0,0,0,16" />

                    <!-- Code Field -->
                    <Border Style="{StaticResource FormFieldBorderStyle}">
                        <StackPanel>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Terminal Code *" Style="{StaticResource FormLabelStyle}" />
                                <Button Grid.Column="1"
                                        Content="Generate"
                                        Command="{Binding GenerateNewCodeCommand}"
                                        Background="#4A4A6A"
                                        Foreground="White"
                                        BorderThickness="0"
                                        Padding="12,4"
                                        FontSize="12"
                                        Cursor="Hand"
                                        Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVisConverter}, ConverterParameter=Inverse}" />
                            </Grid>
                            <TextBox Text="{Binding Code, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource FormTextBoxStyle}"
                                     MaxLength="20" />
                            <TextBlock Text="{Binding CodeError}"
                                       Style="{StaticResource ErrorTextStyle}"
                                       Visibility="{Binding CodeError, Converter={StaticResource BoolToVisConverter}}" />
                        </StackPanel>
                    </Border>

                    <!-- Name Field -->
                    <Border Style="{StaticResource FormFieldBorderStyle}">
                        <StackPanel>
                            <TextBlock Text="Terminal Name *" Style="{StaticResource FormLabelStyle}" />
                            <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource FormTextBoxStyle}"
                                     MaxLength="100" />
                            <TextBlock Text="{Binding NameError}"
                                       Style="{StaticResource ErrorTextStyle}"
                                       Visibility="{Binding NameError, Converter={StaticResource BoolToVisConverter}}" />
                        </StackPanel>
                    </Border>

                    <!-- Description Field -->
                    <Border Style="{StaticResource FormFieldBorderStyle}">
                        <StackPanel>
                            <TextBlock Text="Description" Style="{StaticResource FormLabelStyle}" />
                            <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource FormTextBoxStyle}"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     Height="80"
                                     VerticalContentAlignment="Top"
                                     MaxLength="500" />
                        </StackPanel>
                    </Border>

                    <!-- Configuration Section -->
                    <TextBlock Text="Configuration"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="White"
                               Margin="0,16,0,16" />

                    <!-- Terminal Type and Business Mode -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="16" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Terminal Type -->
                        <Border Grid.Column="0" Style="{StaticResource FormFieldBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="Terminal Type" Style="{StaticResource FormLabelStyle}" />
                                <ComboBox ItemsSource="{Binding TerminalTypes}"
                                          SelectedValue="{Binding SelectedTerminalType}"
                                          SelectedValuePath="Type"
                                          DisplayMemberPath="DisplayName"
                                          Style="{StaticResource FormComboBoxStyle}" />
                            </StackPanel>
                        </Border>

                        <!-- Business Mode -->
                        <Border Grid.Column="2" Style="{StaticResource FormFieldBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="Business Mode" Style="{StaticResource FormLabelStyle}" />
                                <ComboBox ItemsSource="{Binding BusinessModes}"
                                          SelectedValue="{Binding SelectedBusinessMode}"
                                          SelectedValuePath="Mode"
                                          DisplayMemberPath="DisplayName"
                                          Style="{StaticResource FormComboBoxStyle}" />
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Main Register Checkbox -->
                    <Border Style="{StaticResource FormFieldBorderStyle}">
                        <CheckBox Content="This is the main register for the store"
                                  IsChecked="{Binding IsMainRegister}"
                                  Foreground="White"
                                  FontSize="16"
                                  VerticalContentAlignment="Center" />
                    </Border>

                    <!-- Machine Identifier (Read-only in Edit mode) -->
                    <Border Style="{StaticResource FormFieldBorderStyle}">
                        <StackPanel>
                            <TextBlock Text="Machine Identifier" Style="{StaticResource FormLabelStyle}" />
                            <TextBox Text="{Binding MachineIdentifier, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource FormTextBoxStyle}"
                                     IsReadOnly="{Binding IsEditMode}"
                                     MaxLength="100" />
                            <TextBlock Text="Machine identifier is automatically set when the terminal registers. In edit mode, use 'Unbind Machine' from the terminal list to clear this."
                                       Foreground="#8888AA"
                                       FontSize="12"
                                       TextWrapping="Wrap"
                                       Margin="0,4,0,0" />
                        </StackPanel>
                    </Border>

                    <!-- Advanced Section (Edit Mode Only) -->
                    <StackPanel Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVisConverter}}">
                        <TextBlock Text="Advanced Configuration"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="White"
                                   Margin="0,16,0,16" />

                        <!-- Printer Configuration -->
                        <Border Style="{StaticResource FormFieldBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="Printer Configuration (JSON)" Style="{StaticResource FormLabelStyle}" />
                                <TextBox Text="{Binding PrinterConfiguration, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource FormTextBoxStyle}"
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         Height="100"
                                         VerticalContentAlignment="Top"
                                         FontFamily="Consolas" />
                            </StackPanel>
                        </Border>

                        <!-- Hardware Configuration -->
                        <Border Style="{StaticResource FormFieldBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="Hardware Configuration (JSON)" Style="{StaticResource FormLabelStyle}" />
                                <TextBox Text="{Binding HardwareConfiguration, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource FormTextBoxStyle}"
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         Height="100"
                                         VerticalContentAlignment="Top"
                                         FontFamily="Consolas" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- Action Buttons -->
        <Border Grid.Row="2"
                Background="#2D2D44"
                CornerRadius="8"
                Padding="16"
                Margin="0,16,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="* Required fields"
                           Foreground="#8888AA"
                           FontSize="14"
                           VerticalAlignment="Center" />

                <Button Grid.Column="1"
                        Content="Cancel"
                        Command="{Binding CancelCommand}"
                        Background="#3D3D5C"
                        Foreground="White"
                        BorderThickness="0"
                        Padding="32,12"
                        FontSize="16"
                        Cursor="Hand"
                        Margin="0,0,12,0"
                        Width="120"
                        Height="48" />

                <Button Grid.Column="2"
                        Command="{Binding SaveCommand}"
                        Background="#4CAF50"
                        Foreground="White"
                        BorderThickness="0"
                        Padding="32,12"
                        FontSize="16"
                        FontWeight="SemiBold"
                        Cursor="Hand"
                        Width="140"
                        Height="48">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Content" Value="Create Terminal" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditMode}" Value="True">
                                    <Setter Property="Content" Value="Save Changes" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </Grid>
        </Border>
    </Grid>
</UserControl>
